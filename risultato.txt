
> codelearning@1.0.0 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js --config jest.config.js tests/security.test.js

  console.log
    Directory backup creata in: C:\Users\eddyr\Desktop\CodeLearning\backups

      at new BackupService (src/services/backupService.js:33:17)

  console.log
    Starting rate limit test

      at Object.<anonymous> (tests/security.test.js:45:21)

(node:19312) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
  console.log
    Database connesso con successo

      at BoundPool.<anonymous> (src/config/database.js:18:11)

  console.log
    Database connesso con successo

      at BoundPool.<anonymous> (src/config/database.js:18:11)

  console.log
    Database connesso con successo

      at BoundPool.<anonymous> (src/config/database.js:18:11)

  console.log
    Database connesso con successo

      at BoundPool.<anonymous> (src/config/database.js:18:11)

  console.log
    Database connesso con successo

      at BoundPool.<anonymous> (src/config/database.js:18:11)

FAIL tests/security.test.js (7.917 s)
  Test Environment
    √ should have correct test environment variables (3 ms)
    √ should mock console.error and console.warn (1 ms)
    √ should have correct test environment variables (1 ms)
    √ should mock console.error and console.warn (1 ms)
  Security Middleware - Rate Limiting
    Authentication Rate Limiting
      √ should limit login attempts (871 ms)
      √ should track login attempts separately by IP (609 ms)
    Admin Routes Rate Limiting
      √ should apply stricter limits to admin routes (720 ms)
    API Rate Limiting
      √ should apply general rate limits to API routes (1077 ms)
      √ should track rate limits separately for different routes (366 ms)
    IP Blacklisting
      × should blacklist IP after repeated violations (1457 ms)
      × should maintain blacklist across different routes (1499 ms)
      √ should track violations separately by IP (326 ms)

  ● Security Middleware - Rate Limiting › IP Blacklisting › should blacklist IP after repeated violations

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 200

    [0m [90m 184 |[39m                 [33m.[39m[36mset[39m([32m'Authorization'[39m[33m,[39m [32m`Bearer ${userToken}`[39m)[33m;[39m
     [90m 185 |[39m
    [31m[1m>[22m[39m[90m 186 |[39m             expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                     [31m[1m^[22m[39m
     [90m 187 |[39m             expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/Access denied due to repeated violations/[39m)[33m;[39m
     [90m 188 |[39m         }[33m,[39m [35m30000[39m)[33m;[39m
     [90m 189 |[39m[0m

      at Object.<anonymous> (tests/security.test.js:186:37)

  ● Security Middleware - Rate Limiting › IP Blacklisting › should maintain blacklist across different routes

    expect(received).toBe(expected) // Object.is equality

    Expected: 403
    Received: 200

    [0m [90m 223 |[39m
     [90m 224 |[39m             responses[33m.[39mforEach(response [33m=>[39m {
    [31m[1m>[22m[39m[90m 225 |[39m                 expect(response[33m.[39mstatus)[33m.[39mtoBe([35m403[39m)[33m;[39m
     [90m     |[39m                                         [31m[1m^[22m[39m
     [90m 226 |[39m                 expect(response[33m.[39mbody[33m.[39mmessage)[33m.[39mtoMatch([35m/Access denied due to repeated violations/[39m)[33m;[39m
     [90m 227 |[39m             })[33m;[39m
     [90m 228 |[39m         }[33m,[39m [35m30000[39m)[33m;[39m[0m

      at tests/security.test.js:225:41
          at Array.forEach (<anonymous>)
      at Object.<anonymous> (tests/security.test.js:224:23)

Test Suites: 1 failed, 1 total
Tests:       2 failed, 10 passed, 12 total
Snapshots:   0 total
Time:        7.971 s, estimated 8 s
Ran all test suites matching /tests\\security.test.js/i.
