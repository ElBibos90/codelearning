
> codelearning@1.0.0 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js --no-cache tests/services/UserService.test.js

(node:34272) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/services/UserService.test.js
  Test Environment
    √ should have correct test environment variables (6 ms)
    √ should mock console.error and console.warn (2 ms)
  UserService
    Authentication
      √ should successfully login user (68 ms)
      √ should fail login with wrong password (59 ms)
      √ should register new user (121 ms)
    Profile Management
      √ should get full profile (3 ms)
      √ should update profile (2 ms)
      × should update preferences (1 ms)
    Password Management
      × should change password (2 ms)
      × should fail with incorrect current password (12 ms)
    Admin Functions
      √ should get all users (3 ms)
      √ should update user role (4 ms)

  ● UserService › Profile Management › should update preferences

    DatabaseError: ReferenceError: pool is not defined

    [0m [90m 224 |[39m                 [36mthrow[39m error[33m;[39m
     [90m 225 |[39m             }
    [31m[1m>[22m[39m[90m 226 |[39m             [36mthrow[39m [36mnew[39m [33mDatabaseError[39m(error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 227 |[39m         }
     [90m 228 |[39m     }
     [90m 229 |[39m     [36masync[39m updateUserRole(userId[33m,[39m role) {[0m

      at UserService.updatePreferences (src/services/UserService.js:226:19)
      at Object.<anonymous> (tests/services/UserService.test.js:81:46)

  ● UserService › Password Management › should change password

    DatabaseError: Error: Illegal arguments: string, undefined

    [0m [90m 149 |[39m                 [36mthrow[39m error[33m;[39m
     [90m 150 |[39m             }
    [31m[1m>[22m[39m[90m 151 |[39m             [36mthrow[39m [36mnew[39m [33mDatabaseError[39m(error)[33m;[39m
     [90m     |[39m                   [31m[1m^[22m[39m
     [90m 152 |[39m         }
     [90m 153 |[39m     }
     [90m 154 |[39m[0m

      at UserService.changePassword (src/services/UserService.js:151:19)
      at Object.<anonymous> (tests/services/UserService.test.js:89:28)

  ● UserService › Password Management › should fail with incorrect current password

    expect(received).rejects.toThrow(expected)

    Expected substring: "Current password is incorrect"
    Received message:   "Error: Illegal arguments: string, undefined"

        [0m [90m 149 |[39m                 [36mthrow[39m error[33m;[39m
         [90m 150 |[39m             }
        [31m[1m>[22m[39m[90m 151 |[39m             [36mthrow[39m [36mnew[39m [33mDatabaseError[39m(error)[33m;[39m
         [90m     |[39m                   [31m[1m^[22m[39m
         [90m 152 |[39m         }
         [90m 153 |[39m     }
         [90m 154 |[39m[0m

      at UserService.changePassword (src/services/UserService.js:151:19)
      at Object.<anonymous> (tests/services/UserService.test.js:102:13)
      at Object.toThrow (node_modules/expect/build/index.js:218:22)
      at Object.<anonymous> (tests/services/UserService.test.js:104:23)

Test Suites: 1 failed, 1 total
Tests:       3 failed, 9 passed, 12 total
Snapshots:   0 total
Time:        1.239 s
Ran all test suites matching /tests\\services\\UserService.test.js/i.
