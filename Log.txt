
> codelearning@1.0.0 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js --no-cache tests/services/CommentService.test.js

(node:11700) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/services/CommentService.test.js
  Test Environment
    âˆš should have correct test environment variables (4 ms)
    âˆš should mock console.error and console.warn (2 ms)
  CommentService
    Comment Creation
      Ã— should create a new comment (1 ms)
      Ã— should fail with empty content
      Ã— should create a reply to a comment (1 ms)
    Comment Retrieval
      Ã— should get lesson comments (1 ms)
      Ã— should get user comments
      Ã— should get comment replies (1 ms)
    Comment Update
      Ã— should update comment content
      Ã— should fail update with unauthorized user
    Comment Deletion
      Ã— should soft delete a comment (1 ms)
      Ã— should fail deletion with unauthorized user
    Validation
      Ã— should validate required fields (1 ms)
      Ã— should require lessonId
      Ã— should require userId (1 ms)
      Ã— should sanitize content

  â— CommentService â€º Comment Creation â€º should create a new comment

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Creation â€º should fail with empty content

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Creation â€º should create a reply to a comment

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Retrieval â€º should get lesson comments

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Retrieval â€º should get user comments

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Retrieval â€º should get comment replies

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Update â€º should update comment content

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Update â€º should fail update with unauthorized user

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Deletion â€º should soft delete a comment

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Comment Deletion â€º should fail deletion with unauthorized user

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Validation â€º should validate required fields

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Validation â€º should require lessonId

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Validation â€º should require userId

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  â— CommentService â€º Validation â€º should sanitize content

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

Test Suites: 1 failed, 1 total
Tests:       14 failed, 2 passed, 16 total
Snapshots:   0 total
Time:        1.016 s
Ran all test suites matching /tests\\services\\CommentService.test.js/i.
