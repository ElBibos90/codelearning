
> codelearning@1.0.0 test
> node --experimental-vm-modules node_modules/jest/bin/jest.js --no-cache tests/services/CommentService.test.js

(node:11700) ExperimentalWarning: VM Modules is an experimental feature and might change at any time
(Use `node --trace-warnings ...` to show where the warning was created)
FAIL tests/services/CommentService.test.js
  Test Environment
    √ should have correct test environment variables (4 ms)
    √ should mock console.error and console.warn (2 ms)
  CommentService
    Comment Creation
      × should create a new comment (1 ms)
      × should fail with empty content
      × should create a reply to a comment (1 ms)
    Comment Retrieval
      × should get lesson comments (1 ms)
      × should get user comments
      × should get comment replies (1 ms)
    Comment Update
      × should update comment content
      × should fail update with unauthorized user
    Comment Deletion
      × should soft delete a comment (1 ms)
      × should fail deletion with unauthorized user
    Validation
      × should validate required fields (1 ms)
      × should require lessonId
      × should require userId (1 ms)
      × should sanitize content

  ● CommentService › Comment Creation › should create a new comment

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Creation › should fail with empty content

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Creation › should create a reply to a comment

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Retrieval › should get lesson comments

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Retrieval › should get user comments

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Retrieval › should get comment replies

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Update › should update comment content

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Update › should fail update with unauthorized user

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Deletion › should soft delete a comment

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Comment Deletion › should fail deletion with unauthorized user

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Validation › should validate required fields

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Validation › should require lessonId

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Validation › should require userId

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

  ● CommentService › Validation › should sanitize content

    error: la relazione "comments" non esiste

    [0m [90m 14 |[39m         [36mtry[39m {
     [90m 15 |[39m             [90m// Pulizia iniziale[39m
    [31m[1m>[22m[39m[90m 16 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM comments'[39m)[33m;[39m
     [90m    |[39m             [31m[1m^[22m[39m
     [90m 17 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lesson_progress'[39m)[33m;[39m
     [90m 18 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM course_enrollments'[39m)[33m;[39m
     [90m 19 |[39m             [36mawait[39m pool[33m.[39mquery([32m'DELETE FROM lessons'[39m)[33m;[39m[0m

      at node_modules/pg-pool/index.js:45:11
      at Object.<anonymous> (tests/services/CommentService.test.js:16:13)

Test Suites: 1 failed, 1 total
Tests:       14 failed, 2 passed, 16 total
Snapshots:   0 total
Time:        1.016 s
Ran all test suites matching /tests\\services\\CommentService.test.js/i.
